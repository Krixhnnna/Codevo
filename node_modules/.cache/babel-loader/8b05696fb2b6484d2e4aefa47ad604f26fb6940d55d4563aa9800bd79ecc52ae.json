{"ast":null,"code":"let supportedFormat;\nlet id = 0;\nexport class BasisManager {\n  constructor(workerSrc) {\n    if (!supportedFormat) supportedFormat = this.getSupportedFormat();\n    this.onMessage = this.onMessage.bind(this);\n    this.queue = new Map();\n    this.initWorker(workerSrc);\n  }\n  getSupportedFormat() {\n    const gl = document.createElement('canvas').getContext('webgl');\n    if (!!gl.getExtension('WEBGL_compressed_texture_etc')) {\n      return 'etc2';\n    } else if (!!gl.getExtension('WEBGL_compressed_texture_astc')) {\n      return 'astc';\n    } else if (!!gl.getExtension('EXT_texture_compression_bptc')) {\n      return 'bptc';\n    } else if (!!gl.getExtension('WEBGL_compressed_texture_s3tc')) {\n      return 's3tc';\n    } else if (!!gl.getExtension('WEBGL_compressed_texture_etc1')) {\n      return 'etc1';\n    } else if (!!gl.getExtension('WEBGL_compressed_texture_pvrtc') || !!gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc')) {\n      return 'pvrtc';\n      // } else if (!!gl.getExtension('WEBGL_compressed_texture_atc')) {\n      //     return 'atc';\n    }\n    return 'none';\n  }\n  initWorker(workerSrc) {\n    this.worker = new Worker(workerSrc);\n    this.worker.onmessage = this.onMessage;\n  }\n  onMessage({\n    data\n  }) {\n    const {\n      id,\n      error,\n      image\n    } = data;\n    if (error) {\n      console.log(error, id);\n      return;\n    }\n    const textureResolve = this.queue.get(id);\n    this.queue.delete(id);\n    image.isBasis = true;\n    textureResolve(image);\n  }\n  parseTexture(buffer) {\n    id++;\n    this.worker.postMessage({\n      id,\n      buffer,\n      supportedFormat\n    });\n    let textureResolve;\n    const promise = new Promise(res => textureResolve = res);\n    this.queue.set(id, textureResolve);\n    return promise;\n  }\n}","map":{"version":3,"names":["supportedFormat","id","BasisManager","constructor","workerSrc","getSupportedFormat","onMessage","bind","queue","Map","initWorker","gl","document","createElement","getContext","getExtension","worker","Worker","onmessage","data","error","image","console","log","textureResolve","get","delete","isBasis","parseTexture","buffer","postMessage","promise","Promise","res","set"],"sources":["/Users/krishnapandey/Desktop/Codevo/node_modules/ogl/src/extras/BasisManager.js"],"sourcesContent":["let supportedFormat;\nlet id = 0;\n\nexport class BasisManager {\n    constructor(workerSrc) {\n        if (!supportedFormat) supportedFormat = this.getSupportedFormat();\n        this.onMessage = this.onMessage.bind(this);\n        this.queue = new Map();\n        this.initWorker(workerSrc);\n    }\n\n    getSupportedFormat() {\n        const gl = document.createElement('canvas').getContext('webgl');\n        if (!!gl.getExtension('WEBGL_compressed_texture_etc')) {\n            return 'etc2';\n        } else if (!!gl.getExtension('WEBGL_compressed_texture_astc')) {\n            return 'astc';\n        } else if (!!gl.getExtension('EXT_texture_compression_bptc')) {\n            return 'bptc';\n        } else if (!!gl.getExtension('WEBGL_compressed_texture_s3tc')) {\n            return 's3tc';\n        } else if (!!gl.getExtension('WEBGL_compressed_texture_etc1')) {\n            return 'etc1';\n        } else if (!!gl.getExtension('WEBGL_compressed_texture_pvrtc') || !!gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc')) {\n            return 'pvrtc';\n            // } else if (!!gl.getExtension('WEBGL_compressed_texture_atc')) {\n            //     return 'atc';\n        }\n        return 'none';\n    }\n\n    initWorker(workerSrc) {\n        this.worker = new Worker(workerSrc);\n        this.worker.onmessage = this.onMessage;\n    }\n\n    onMessage({ data }) {\n        const { id, error, image } = data;\n        if (error) {\n            console.log(error, id);\n            return;\n        }\n        const textureResolve = this.queue.get(id);\n        this.queue.delete(id);\n        image.isBasis = true;\n        textureResolve(image);\n    }\n\n    parseTexture(buffer) {\n        id++;\n        this.worker.postMessage({\n            id,\n            buffer,\n            supportedFormat,\n        });\n        let textureResolve;\n        const promise = new Promise((res) => (textureResolve = res));\n        this.queue.set(id, textureResolve);\n        return promise;\n    }\n}\n"],"mappings":"AAAA,IAAIA,eAAe;AACnB,IAAIC,EAAE,GAAG,CAAC;AAEV,OAAO,MAAMC,YAAY,CAAC;EACtBC,WAAWA,CAACC,SAAS,EAAE;IACnB,IAAI,CAACJ,eAAe,EAAEA,eAAe,GAAG,IAAI,CAACK,kBAAkB,CAAC,CAAC;IACjE,IAAI,CAACC,SAAS,GAAG,IAAI,CAACA,SAAS,CAACC,IAAI,CAAC,IAAI,CAAC;IAC1C,IAAI,CAACC,KAAK,GAAG,IAAIC,GAAG,CAAC,CAAC;IACtB,IAAI,CAACC,UAAU,CAACN,SAAS,CAAC;EAC9B;EAEAC,kBAAkBA,CAAA,EAAG;IACjB,MAAMM,EAAE,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC;IAC/D,IAAI,CAAC,CAACH,EAAE,CAACI,YAAY,CAAC,8BAA8B,CAAC,EAAE;MACnD,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACJ,EAAE,CAACI,YAAY,CAAC,+BAA+B,CAAC,EAAE;MAC3D,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACJ,EAAE,CAACI,YAAY,CAAC,8BAA8B,CAAC,EAAE;MAC1D,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACJ,EAAE,CAACI,YAAY,CAAC,+BAA+B,CAAC,EAAE;MAC3D,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACJ,EAAE,CAACI,YAAY,CAAC,+BAA+B,CAAC,EAAE;MAC3D,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACJ,EAAE,CAACI,YAAY,CAAC,gCAAgC,CAAC,IAAI,CAAC,CAACJ,EAAE,CAACI,YAAY,CAAC,uCAAuC,CAAC,EAAE;MAC1H,OAAO,OAAO;MACd;MACA;IACJ;IACA,OAAO,MAAM;EACjB;EAEAL,UAAUA,CAACN,SAAS,EAAE;IAClB,IAAI,CAACY,MAAM,GAAG,IAAIC,MAAM,CAACb,SAAS,CAAC;IACnC,IAAI,CAACY,MAAM,CAACE,SAAS,GAAG,IAAI,CAACZ,SAAS;EAC1C;EAEAA,SAASA,CAAC;IAAEa;EAAK,CAAC,EAAE;IAChB,MAAM;MAAElB,EAAE;MAAEmB,KAAK;MAAEC;IAAM,CAAC,GAAGF,IAAI;IACjC,IAAIC,KAAK,EAAE;MACPE,OAAO,CAACC,GAAG,CAACH,KAAK,EAAEnB,EAAE,CAAC;MACtB;IACJ;IACA,MAAMuB,cAAc,GAAG,IAAI,CAAChB,KAAK,CAACiB,GAAG,CAACxB,EAAE,CAAC;IACzC,IAAI,CAACO,KAAK,CAACkB,MAAM,CAACzB,EAAE,CAAC;IACrBoB,KAAK,CAACM,OAAO,GAAG,IAAI;IACpBH,cAAc,CAACH,KAAK,CAAC;EACzB;EAEAO,YAAYA,CAACC,MAAM,EAAE;IACjB5B,EAAE,EAAE;IACJ,IAAI,CAACe,MAAM,CAACc,WAAW,CAAC;MACpB7B,EAAE;MACF4B,MAAM;MACN7B;IACJ,CAAC,CAAC;IACF,IAAIwB,cAAc;IAClB,MAAMO,OAAO,GAAG,IAAIC,OAAO,CAAEC,GAAG,IAAMT,cAAc,GAAGS,GAAI,CAAC;IAC5D,IAAI,CAACzB,KAAK,CAAC0B,GAAG,CAACjC,EAAE,EAAEuB,cAAc,CAAC;IAClC,OAAOO,OAAO;EAClB;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}